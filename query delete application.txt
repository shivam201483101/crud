CREATE OR REPLACE PROCEDURE yono_cstmr.delete_leadId(
    p_ref_no VARCHAR,
    OUT p_status INTEGER DEFAULT 0
)
LANGUAGE plpgsql
AS $$
DECLARE
    v_mbl_no VARCHAR;
BEGIN
    p_status := 0;  

    
    SELECT mbl_no INTO v_mbl_no
    FROM yono_cstmr.mbl_dtls
    WHERE ref_no = p_ref_no;

    IF NOT FOUND THEN
        RETURN; 
    END IF;

   
    BEGIN
       DELETE FROM yono_cstmr.mbl_dtls WHERE ref_no = p_ref_no;
       DELETE FROM yono_cstmr.cstmr_pd WHERE ref_no = p_ref_no;
       DELETE FROM yono_cstmr.ekyc_pan_dtls WHERE ref_no = p_ref_no;
       DELETE FROM yono_cstmr.onbrdng_status WHERE ref_no = p_ref_no;
       DELETE FROM yono_cstmr.cstmr_onbrdng_hstry WHERE ref_no = p_ref_no;
       DELETE FROM yono_accnt.accnt_onbrdng_status WHERE ref_no = p_ref_no;
       DELETE FROM yono_rstr.mbl_blk WHERE mbl_no = v_mbl_no;
       DELETE from yono_accnt.nominee_dtls WHERE ref_no = p_ref_no;
       DELETE from yono_cstmr.casa_brnch_status where ref_no = p_ref_no;
       DELETE from yono_cstmr.ovd where  ref_no = p_ref_no;
       DELETE from yono_cstmr.branch_rmrk where ref_no = p_ref_no;
       DELETE from yono_cstmr.cstmr_add where ref_no = p_ref_no;
       DELETE from yono_cstmr.mkr_chckr_dtls where ref_no = p_ref_no;
       DELETE from yono_cstmr.vkyc_dtls where ref_no = p_ref_no;
       DELETE from yono_rstr.aadhar_txn_history where ref_no = p_ref_no;
       DELETE from yono_dcmnt.edms_doc_dtls where ref_no = p_ref_no;

        p_status := 1;  
    EXCEPTION WHEN OTHERS THEN       
        p_status := 0;
    END;

END;
$$;
